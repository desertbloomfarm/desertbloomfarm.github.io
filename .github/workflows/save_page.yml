name: Save HTML Page

on:
  repository_dispatch:
    types: [save_page]

jobs:
  save_page:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Debug Token
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
        run: |
          echo "DEBUG: Token –ø–µ—Ä–µ–¥–∞–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é —Å—Ä–µ–¥—ã."
          echo "Token: ${GH_TOKEN:0:4}****"  # –í—ã–≤–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 4 —Å–∏–º–≤–æ–ª–∞ —Ç–æ–∫–µ–Ω–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

      - name: Save HTML Page
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"

          # üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `pages`
          echo "DEBUG: –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é pages..."
          mkdir -p pages
          ls -la pages

          # üìÑ –°–æ–∑–¥–∞—ë–º —Ñ–∞–π–ª –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –µ–≥–æ
          echo "DEBUG: –°–æ–∑–¥–∞—ë–º —Ñ–∞–π–ª pages/${{ github.event.client_payload.title }}.html"
          echo "${{ github.event.client_payload.content }}" > pages/${{ github.event.client_payload.title }}.html
          
          echo "DEBUG: –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞"
          cat pages/${{ github.event.client_payload.title }}.html

          # üîÑ –î–æ–±–∞–≤–ª—è–µ–º –≤ Git
          echo "DEBUG: –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∞–π–ª –≤ git..."
          git add pages/${{ github.event.client_payload.title }}.html
          git commit -m "–î–æ–±–∞–≤–ª–µ–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞: ${{ github.event.client_payload.title }}"

          # ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –ø–µ—Ä–µ–¥ –ø—É—à–µ–º
          echo "DEBUG: Git status –ø–µ—Ä–µ–¥ –ø—É—à–µ–º:"
          git status

          echo "DEBUG: –ü–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ–º–º–∏—Ç:"
          git log -1

          # üöÄ –ü—É—à–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
          echo "DEBUG: –ü—É—à–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π"
          git push https://x-access-token:${GH_TOKEN}@github.com/${{ github.repository }}.git
