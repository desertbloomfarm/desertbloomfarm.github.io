name: Save HTML Page

on:
  repository_dispatch:
    types: [save_page]

jobs:
  save_page:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          persist-credentials: false  # ‚¨ÖÔ∏è –û—Ç–∫–ª—é—á–∞–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ GitHub –∫—Ä–µ–¥—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–≤–æ–π —Ç–æ–∫–µ–Ω

      - name: Debug Token  # ‚¨ÖÔ∏è –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –ª–∏ —Ç–æ–∫–µ–Ω
        run: echo "Token is set"

      - name: Save HTML Page
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          mkdir -p pages  # ‚úÖ –°–æ–∑–¥–∞—ë—Ç –ø–∞–ø–∫—É, –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç

          # üü¢ –û—Ç–ª–∞–¥–∫–∞: –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
          echo "üîç DEBUG: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã..."
          echo -e "${{ github.event.client_payload.content }}" > pages/${{ github.event.client_payload.title }}.html
          ls -la pages/

          # üü¢ –û—Ç–ª–∞–¥–∫–∞: –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å git
          git status

          git add pages/${{ github.event.client_payload.title }}.html
          git commit -m "–î–æ–±–∞–≤–ª–µ–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞: ${{ github.event.client_payload.title }}"

          # üü¢ –û—Ç–ª–∞–¥–∫–∞: –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–æ–º–º–∏—Ç –ø—Ä–∏–º–µ–Ω–∏–ª—Å—è
          git log --oneline -n 5

          git push https://x-access-token:${{ secrets.GH_TOKEN }}@github.com/${{ github.repository }}.git
