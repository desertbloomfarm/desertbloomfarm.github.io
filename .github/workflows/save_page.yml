name: Save HTML Page

on:
  repository_dispatch:
    types: [save_page]

jobs:
  save_page:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Debug Token
        run: echo "Token: ${{ secrets.GH_TOKEN }}"

      - name: Save HTML Page
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"

          # –°–æ–∑–¥–∞—ë–º –ø–∞–ø–∫—É, –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
          mkdir -p pages  

          # –û—Ç–ª–∞–¥–∫–∞ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Ñ–∞–π–ª–∞
          echo "üîç DEBUG: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã..."
          echo -e "${{ github.event.client_payload.content }}" > pages/${{ github.event.client_payload.title }}.html

          # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ñ–∞–π–ª —Å–æ–∑–¥–∞–ª—Å—è
          ls -la pages/

          # –î–æ–±–∞–≤–ª—è–µ–º –≤ git
          git add pages/${{ github.event.client_payload.title }}.html
          git commit -m "–î–æ–±–∞–≤–ª–µ–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞: ${{ github.event.client_payload.title }}"

          # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å git
          git status
          git log --oneline -n 5

          # –û–±–Ω–æ–≤–ª—è–µ–º main –ø–µ—Ä–µ–¥ –ø—É—à–µ–º, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
          git pull --rebase https://x-access-token:${GH_TOKEN}@github.com/${{ github.repository }}.git main

          # –ü—É—à–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
          git push https://x-access-token:${GH_TOKEN}@github.com/${{ github.repository }}.git
