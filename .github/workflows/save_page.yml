name: Save HTML Page

on:
  repository_dispatch:
    types: [save_page]

jobs:
  save_page:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Debug Token
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
        run: echo "üîç DEBUG: Token –ø–µ—Ä–µ–¥–∞–Ω? $GH_TOKEN"

      - name: Save HTML Page
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"

          mkdir -p pages  # ‚úÖ –°–æ–∑–¥–∞—ë—Ç –ø–∞–ø–∫—É, –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç

          # üü¢ –û—Ç–ª–∞–¥–∫–∞: –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
          echo "üîç DEBUG: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã..."
          echo "${{ github.event.client_payload.content }}" > pages/${{ github.event.client_payload.title }}.html
          ls -la pages/

          # ‚úÖ –ü–æ–¥—Ç—è–≥–∏–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º
          git pull --rebase origin main

          # üü¢ –û—Ç–ª–∞–¥–∫–∞: –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å git
          git status

          git add pages/${{ github.event.client_payload.title }}.html
          git commit -m "–î–æ–±–∞–≤–ª–µ–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞: ${{ github.event.client_payload.title }}"

          # üü¢ –û—Ç–ª–∞–¥–∫–∞: –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–æ–º–º–∏—Ç –ø—Ä–∏–º–µ–Ω–∏–ª—Å—è
          git log --oneline -n 5

          # ‚úÖ –û–±—ã—á–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
          git push https://x-access-token:${GH_TOKEN}@github.com/${{ github.repository }}.git
